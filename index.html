<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trivanta HR Manager</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary-blue: #0052CC;
            --secondary-blue: #0065FF;
            --dark-blue: #003D99;
            --light-blue: #E6F0FF;
            --text-primary: #172B4D;
            --text-secondary: #5E6C84;
            --border-color: #DFE1E6;
            --background: #FAFBFC;
            --white: #FFFFFF;
            --success: #00875A;
            --warning: #FF991F;
            --danger: #DE350B;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .navbar {
            background-color: var(--white);
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
            padding: 1rem 0;
        }
        
        .navbar-brand {
            font-weight: 600;
            font-size: 1.25rem;
            color: var(--primary-blue);
            letter-spacing: -0.02em;
        }
        
        .navbar-text {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .btn-outline-primary {
            color: var(--primary-blue);
            border-color: var(--primary-blue);
        }
        
        .btn-outline-primary:hover {
            background-color: var(--primary-blue);
            border-color: var(--primary-blue);
        }
        
        .sidebar {
            background-color: var(--white);
            border-right: 1px solid var(--border-color);
            min-height: calc(100vh - 73px);
            padding: 0;
        }
        
        .sidebar .nav-link {
            color: var(--text-primary);
            padding: 1rem 1.5rem;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 0.9375rem;
        }
        
        .sidebar .nav-link:hover {
            background-color: var(--light-blue);
            color: var(--primary-blue);
        }
        
        .sidebar .nav-link.active {
            background-color: var(--light-blue);
            color: var(--primary-blue);
            border-left-color: var(--primary-blue);
        }
        
        .sidebar .nav-link i {
            width: 20px;
            margin-right: 0.75rem;
        }
        
        .main-content {
            padding: 2rem 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .card {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
            background-color: var(--white);
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            background-color: var(--white);
            border-bottom: 1px solid var(--border-color);
            padding: 1.25rem 1.5rem;
            font-weight: 600;
            font-size: 1.125rem;
            color: var(--text-primary);
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        .stats-card {
            background-color: var(--white);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-blue);
            line-height: 1;
            margin-bottom: 0.5rem;
        }
        
        .stats-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .login-container {
            min-height: 100vh;
            background-color: var(--background);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .login-card {
            background: var(--white);
            border-radius: 8px;
            padding: 2.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            max-width: 420px;
            width: 100%;
            border: 1px solid var(--border-color);
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .login-header h2 {
            color: var(--primary-blue);
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 1.75rem;
        }
        
        .login-header p {
            color: var(--text-secondary);
            font-size: 0.9375rem;
        }
        
        .form-label {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        .form-control, .form-select {
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 0.75rem;
            font-size: 0.9375rem;
            transition: border-color 0.2s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px var(--light-blue);
            outline: none;
        }
        
        .btn-primary {
            background-color: var(--primary-blue);
            border: none;
            border-radius: 4px;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            font-size: 0.9375rem;
            transition: background-color 0.2s ease;
        }
        
        .btn-primary:hover {
            background-color: var(--dark-blue);
        }
        
        .btn-secondary {
            background-color: var(--text-secondary);
            border: none;
            border-radius: 4px;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
        }
        
        .table {
            font-size: 0.9375rem;
        }
        
        .table thead th {
            background-color: var(--background);
            color: var(--text-primary);
            border-bottom: 2px solid var(--border-color);
            font-weight: 600;
            padding: 1rem 0.75rem;
            font-size: 0.8125rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .table tbody td {
            padding: 1rem 0.75rem;
            vertical-align: middle;
            border-bottom: 1px solid var(--border-color);
        }
        
        .table tbody tr:hover {
            background-color: var(--light-blue);
        }
        
        .badge {
            padding: 0.375rem 0.75rem;
            border-radius: 4px;
            font-weight: 500;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .badge-role {
            background-color: var(--light-blue);
            color: var(--primary-blue);
        }
        
        .badge-status-selected {
            background-color: #E3FCEF;
            color: var(--success);
        }
        
        .badge-status-pending {
            background-color: #FFF0B3;
            color: #974F0C;
        }
        
        .badge-status-joined {
            background-color: #E3FCEF;
            color: var(--success);
        }
        
        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.8125rem;
            border-radius: 4px;
            font-weight: 500;
        }
        
        .btn-action {
            background-color: var(--white);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            margin-right: 0.25rem;
        }
        
        .btn-action:hover {
            background-color: var(--background);
            border-color: var(--primary-blue);
            color: var(--primary-blue);
        }
        
        .hidden {
            display: none;
        }
        
        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
        }
        
        .demo-info {
            background-color: var(--light-blue);
            border: 1px solid var(--primary-blue);
            border-radius: 4px;
            padding: 1rem;
            margin-top: 1.5rem;
            font-size: 0.8125rem;
            color: var(--text-primary);
        }
        
        .alert {
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            border: 1px solid transparent;
            border-radius: 4px;
        }
        
        .alert-danger {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        .alert-success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loading.show {
            display: block;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                min-height: auto;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .stats-card {
                padding: 1rem;
            }
            
            .stats-number {
                font-size: 2rem;
            }
            
            .table {
                font-size: 0.8125rem;
            }
            
            .card-header {
                padding: 1rem;
            }
            
            .card-body {
                padding: 1rem;
            }
            
            .login-card {
                padding: 1.5rem;
            }
        }
        
        @media (max-width: 576px) {
            .table-responsive {
                overflow-x: auto;
            }
            
            .btn-sm {
                padding: 0.25rem 0.5rem;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h2>Trivanta HR Manager</h2>
                <p>Sign in to your account</p>
            </div>
            
            <div id="loginError" class="alert alert-danger hidden">
                Invalid credentials. Please try again.
            </div>
            
            <form id="loginForm">
                <div class="mb-3">
                    <label class="form-label">Username</label>
                    <input type="text" id="username" class="form-control" required placeholder="Enter username">
                </div>
                <div class="mb-3">
                    <label class="form-label">Password</label>
                    <input type="password" id="password" class="form-control" required placeholder="Enter password">
                </div>
                <div class="mb-4">
                    <label class="form-label">Portal Type</label>
                    <select id="userType" class="form-select">
                        <option value="vendor">Vendor Portal</option>
                        <option value="admin">Admin Portal</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary w-100">
                    Sign In
                </button>
            </form>
            
            <div class="demo-info">
                <strong>Demo Credentials:</strong><br>
                <strong>Admin:</strong> Siddhant / 102005<br>
                <strong>Vendor:</strong> testvendor / password
            </div>
        </div>
    </div>

    <!-- Vendor Portal -->
    <div id="vendorPortal" class="hidden">
        <nav class="navbar">
            <div class="container-fluid">
                <span class="navbar-brand">
                    <i class="fas fa-users-cog"></i> Trivanta HR - Vendor Portal
                </span>
                <div class="navbar-nav ms-auto d-flex flex-row align-items-center">
                    <span class="navbar-text me-3">Welcome, <span id="vendorName"></span></span>
                    <button class="btn btn-outline-primary btn-sm" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </nav>

        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-2 col-md-3 sidebar">
                    <ul class="nav flex-column pt-3">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showSection('vendorDashboard', event)">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('addCandidate', event)">
                                <i class="fas fa-user-plus"></i> Add Candidate
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('manageCandidates', event)">
                                <i class="fas fa-users"></i> Manage Candidates
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="col-lg-10 col-md-9 main-content">
                    <!-- Vendor Dashboard -->
                    <div id="vendorDashboard" class="section">
                        <h1 class="page-title">Dashboard</h1>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="stats-card">
                                    <div class="stats-number" id="vendorTotalCandidates">0</div>
                                    <div class="stats-label">Total Candidates</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stats-card">
                                    <div class="stats-number" id="vendorSelectedCandidates">0</div>
                                    <div class="stats-label">Selected Candidates</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stats-card">
                                    <div class="stats-number" id="vendorPendingCandidates">0</div>
                                    <div class="stats-label">Pending Interviews</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Add Candidate -->
                    <div id="addCandidate" class="section hidden">
                        <h1 class="page-title">Add New Candidate</h1>
                        <div id="candidateSuccessAlert" class="alert alert-success hidden"></div>
                        <div class="card">
                            <div class="card-body">
                                <form id="candidateForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Full Name</label>
                                            <input type="text" name="name" class="form-control" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Phone Number</label>
                                            <input type="tel" name="number" class="form-control" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Email</label>
                                            <input type="email" name="email" class="form-control" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Role</label>
                                            <select name="role" class="form-select" required>
                                                <option value="">Select Role</option>
                                                <option value="Fitter">Fitter</option>
                                                <option value="Helper">Helper</option>
                                                <option value="Site Supervisor">Site Supervisor</option>
                                                <option value="Welder">Welder</option>
                                                <option value="Parking Operator">Parking Operator</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Current Salary (₹)</label>
                                            <input type="number" name="currentSalary" class="form-control" required min="0">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Expected Salary (₹)</label>
                                            <input type="number" name="expectedSalary" class="form-control" required min="0">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Total Experience (Years)</label>
                                            <input type="number" name="totalExperience" class="form-control" step="0.1" required min="0">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Relevant Experience (Years)</label>
                                            <input type="number" name="relevantExperience" class="form-control" step="0.1" required min="0">
                                        </div>
                                        <div class="col-12 mb-3">
                                            <label class="form-label">Date of Interview</label>
                                            <input type="date" name="interviewDate" class="form-control">
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <button type="reset" class="btn btn-secondary me-2">Reset</button>
                                        <button type="submit" class="btn btn-primary">Add Candidate</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Manage Candidates -->
                    <div id="manageCandidates" class="section hidden">
                        <h1 class="page-title">Manage Candidates</h1>
                        <div class="loading" id="vendorCandidatesLoading">
                            <i class="fas fa-spinner fa-spin fa-2x"></i>
                            <p>Loading candidates...</p>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Role</th>
                                                <th>Phone</th>
                                                <th>Expected Salary</th>
                                                <th>Offered Salary</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="vendorCandidatesTable"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Portal -->
    <div id="adminPortal" class="hidden">
        <nav class="navbar">
            <div class="container-fluid">
                <span class="navbar-brand">
                    <i class="fas fa-users-cog"></i> Trivanta HR - Admin Portal
                </span>
                <div class="navbar-nav ms-auto d-flex flex-row align-items-center">
                    <span class="navbar-text me-3">Welcome, Administrator</span>
                    <button class="btn btn-outline-primary btn-sm" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </nav>

        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-2 col-md-3 sidebar">
                    <ul class="nav flex-column pt-3">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showSection('adminDashboard', event)">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('allCandidates', event)">
                                <i class="fas fa-users"></i> All Candidates
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('manageVendors', event)">
                                <i class="fas fa-building"></i> Manage Vendors
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('vendors', event)">
                                <i class="fas fa-chart-line"></i> Vendor Analytics
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="col-lg-10 col-md-9 main-content">
                    <!-- Admin Dashboard -->
                    <div id="adminDashboard" class="section">
                        <h1 class="page-title">Dashboard</h1>
                        <div class="row">
                            <div class="col-lg-3 col-md-6">
                                <div class="stats-card">
                                    <div class="stats-number" id="adminTotalCandidates">0</div>
                                    <div class="stats-label">Total Candidates</div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="stats-card">
                                    <div class="stats-number" id="adminSelectedCandidates">0</div>
                                    <div class="stats-label">Selected</div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="stats-card">
                                    <div class="stats-number" id="adminActiveVendors">0</div>
                                    <div class="stats-label">Active Vendors</div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="stats-card">
                                    <div class="stats-number" id="adminPendingInterviews">0</div>
                                    <div class="stats-label">Pending Interviews</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- All Candidates -->
                    <div id="allCandidates" class="section hidden">
                        <h1 class="page-title">All Candidates</h1>
                        <div class="loading" id="allCandidatesLoading">
                            <i class="fas fa-spinner fa-spin fa-2x"></i>
                            <p>Loading candidates...</p>
                        </div>
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span>Candidate List</span>
                                <div>
                                    <select id="vendorFilter" class="form-select form-select-sm d-inline-block w-auto me-2" onchange="loadAllCandidates()">
                                        <option value="">All Vendors</option>
                                    </select>
                                    <select id="roleFilter" class="form-select form-select-sm d-inline-block w-auto" onchange="loadAllCandidates()">
                                        <option value="">All Roles</option>
                                        <option value="Fitter">Fitter</option>
                                        <option value="Helper">Helper</option>
                                        <option value="Site Supervisor">Site Supervisor</option>
                                        <option value="Welder">Welder</option>
                                        <option value="Parking Operator">Parking Operator</option>
                                    </select>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Vendor</th>
                                                <th>Role</th>
                                                <th>Phone</th>
                                                <th>Expected Salary</th>
                                                <th>Offered Salary</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="adminCandidatesTable"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Manage Vendors -->
                    <div id="manageVendors" class="section hidden">
                        <h1 class="page-title">Manage Vendors</h1>
                        
                        <div id="vendorSuccessAlert" class="alert alert-success hidden"></div>
                        
                        <div class="card mb-4">
                            <div class="card-header">Add New Vendor</div>
                            <div class="card-body">
                                <form id="addVendorForm">
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Vendor Name</label>
                                            <input type="text" name="vendorName" class="form-control" required>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Username</label>
                                            <input type="text" name="vendorUsername" class="form-control" required>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Password</label>
                                            <input type="password" name="vendorPassword" class="form-control" required>
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <button type="submit" class="btn btn-primary">Add Vendor</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <div class="loading" id="vendorsManageLoading">
                            <i class="fas fa-spinner fa-spin fa-2x"></i>
                            <p>Loading vendors...</p>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">All Vendors</div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Vendor Name</th>
                                                <th>Username</th>
                                                <th>Total Candidates</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="manageVendorsTable"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Vendors Analytics -->
                    <div id="vendors" class="section hidden">
                        <h1 class="page-title">Vendor Analytics</h1>
                        <div class="loading" id="vendorsAnalyticsLoading">
                            <i class="fas fa-spinner fa-spin fa-2x"></i>
                            <p>Loading analytics...</p>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Vendor Name</th>
                                                <th>Total Candidates</th>
                                                <th>Selected</th>
                                                <th>Success Rate</th>
                                                <th>Last Activity</th>
                                            </tr>
                                        </thead>
                                        <tbody id="vendorsTable"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Candidate Modal (Vendor) -->
    <div class="modal fade" id="editCandidateModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Candidate</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editCandidateForm">
                        <input type="hidden" id="editCandidateId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Full Name</label>
                                <input type="text" id="editName" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" id="editNumber" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" id="editEmail" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Role</label>
                                <select id="editRole" class="form-select" required>
                                    <option value="Fitter">Fitter</option>
                                    <option value="Helper">Helper</option>
                                    <option value="Site Supervisor">Site Supervisor</option>
                                    <option value="Welder">Welder</option>
                                    <option value="Parking Operator">Parking Operator</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Current Salary (₹)</label>
                                <input type="number" id="editCurrentSalary" class="form-control" required min="0">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Expected Salary (₹)</label>
                                <input type="number" id="editExpectedSalary" class="form-control" required min="0">
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Offered Salary (₹) <span class="text-muted">(Read-only, set by Admin)</span></label>
                                <input type="number" id="editOfferedSalary" class="form-control" min="0" readonly>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Date of Interview</label>
                                <input type="date" id="editInterviewDate" class="form-control">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Selection Date <span class="text-muted">(Read-only, set by Admin)</span></label>
                                <input type="date" id="editSelectionDate" class="form-control" readonly>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Joining Date <span class="text-muted">(Read-only, set by Admin)</span></label>
                                <input type="date" id="editJoiningDate" class="form-control" readonly>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateCandidate()">Update Candidate</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Candidate Modal (Admin) -->
    <div class="modal fade" id="editCandidateModalAdmin" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Candidate (Admin)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editCandidateFormAdmin">
                        <input type="hidden" id="editCandidateIdAdmin">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Full Name</label>
                                <input type="text" id="editNameAdmin" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" id="editNumberAdmin" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" id="editEmailAdmin" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Role</label>
                                <select id="editRoleAdmin" class="form-select" required>
                                    <option value="Fitter">Fitter</option>
                                    <option value="Helper">Helper</option>
                                    <option value="Site Supervisor">Site Supervisor</option>
                                    <option value="Welder">Welder</option>
                                    <option value="Parking Operator">Parking Operator</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Current Salary (₹)</label>
                                <input type="number" id="editCurrentSalaryAdmin" class="form-control" required min="0">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Expected Salary (₹)</label>
                                <input type="number" id="editExpectedSalaryAdmin" class="form-control" required min="0">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Offered Salary (₹)</label>
                                <input type="number" id="editOfferedSalaryAdmin" class="form-control" min="0">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Interview Date</label>
                                <input type="date" id="editInterviewDateAdmin" class="form-control">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Selection Date</label>
                                <input type="date" id="editSelectionDateAdmin" class="form-control">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Joining Date</label>
                                <input type="date" id="editJoiningDateAdmin" class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateCandidateAdmin()">Update Candidate</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, query, where, orderBy, Timestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDT2e0j-Nvd3weMZaCI7rCb2vJ3DwCdIrk",
            authDomain: "dazzlohr.firebaseapp.com",
            projectId: "dazzlohr",
            storageBucket: "dazzlohr.firebasestorage.app",
            messagingSenderId: "997294562239",
            appId: "1:997294562239:web:e49d02aecd7b0aa99b9f0a",
            measurementId: "G-PCN9GGF3DY"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Make Firebase functions globally available
        window.db = db;
        window.collection = collection;
        window.addDoc = addDoc;
        window.getDocs = getDocs;
        window.doc = doc;
        window.updateDoc = updateDoc;
        window.deleteDoc = deleteDoc;
        window.query = query;
        window.where = where;
        window.orderBy = orderBy;
        window.Timestamp = Timestamp;

        // Initialize demo data in Firestore
        async function initializeDemoData() {
            try {
                // Check if vendors exist
                const vendorsSnapshot = await getDocs(collection(db, 'vendors'));
                
                if (vendorsSnapshot.empty) {
                    // Add demo vendors
                    await addDoc(collection(db, 'vendors'), {
                        name: 'Test Vendor Company',
                        username: 'testvendor',
                        password: 'password',
                        createdAt: Timestamp.now()
                    });

                    await addDoc(collection(db, 'vendors'), {
                        name: 'ABC Solutions',
                        username: 'abcsolutions',
                        password: 'abc123',
                        createdAt: Timestamp.now()
                    });

                    console.log('Demo vendors created');
                }
            } catch (error) {
                console.error('Error initializing demo data:', error);
            }
        }

        // Initialize on load
        initializeDemoData();
    </script>
    
    <script>
        // Global variables
        let currentUser = null;

        // Utility functions
        function sanitizeInput(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function validateSalary(current, expected, offered) {
            if (expected < current) {
                alert('Expected salary should be greater than or equal to current salary');
                return false;
            }
            if (offered && offered < expected) {
                if (!confirm('Offered salary is less than expected salary. Continue?')) {
                    return false;
                }
            }
            return true;
        }

        function getStatus(selectionDate, joiningDate) {
            if (joiningDate) return 'Joined';
            if (selectionDate) return 'Selected';
            return 'Interview Pending';
        }

        function getStatusBadgeClass(status) {
            const statusMap = {
                'Joined': 'badge-status-joined',
                'Selected': 'badge-status-selected',
                'Interview Pending': 'badge-status-pending'
            };
            return statusMap[status] || 'badge-status-pending';
        }

        function showLoading(elementId) {
            const el = document.getElementById(elementId);
            if (el) el.classList.add('show');
        }

        function hideLoading(elementId) {
            const el = document.getElementById(elementId);
            if (el) el.classList.remove('show');
        }

        function showAlert(elementId, message, timeout = 3000) {
            const alert = document.getElementById(elementId);
            if (alert) {
                alert.textContent = message;
                alert.classList.remove('hidden');
                setTimeout(() => {
                    alert.classList.add('hidden');
                }, timeout);
            }
        }

        // Login and navigation functions
        window.handleLogin = async function(event) {
            if (event) {
                event.preventDefault();
            }
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const userType = document.getElementById('userType').value;
            
            document.getElementById('loginError').classList.add('hidden');
            
            if (userType === 'admin' && username === 'Siddhant' && password === '102005') {
                currentUser = { type: 'admin', name: 'Administrator' };
                showPortal('admin');
            } else if (userType === 'vendor') {
                try {
                    const vendorsRef = window.collection(window.db, 'vendors');
                    const q = window.query(vendorsRef, window.where('username', '==', username), window.where('password', '==', password));
                    const querySnapshot = await window.getDocs(q);
                    
                    if (!querySnapshot.empty) {
                        const vendorDoc = querySnapshot.docs[0];
                        const vendorData = vendorDoc.data();
                        currentUser = { 
                            type: 'vendor', 
                            id: vendorDoc.id, 
                            name: vendorData.name,
                            username: vendorData.username
                        };
                        document.getElementById('vendorName').textContent = vendorData.name;
                        showPortal('vendor');
                    } else {
                        showLoginError();
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    alert('Login failed. Please try again.');
                }
            } else {
                showLoginError();
            }
        }

        function showLoginError() {
            document.getElementById('loginError').classList.remove('hidden');
        }

        function showPortal(type) {
            document.getElementById('loginScreen').classList.add('hidden');
            if (type === 'admin') {
                document.getElementById('adminPortal').classList.remove('hidden');
                loadAdminDashboard();
            } else {
                document.getElementById('vendorPortal').classList.remove('hidden');
                // Show dashboard and load data immediately
                showSection('vendorDashboard', null);
                loadVendorDashboard();
            }
        }

        window.logout = function() {
            currentUser = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('adminPortal').classList.add('hidden');
            document.getElementById('vendorPortal').classList.add('hidden');
            document.getElementById('loginForm').reset();
            document.getElementById('loginError').classList.add('hidden');
        }

        window.showSection = function(sectionId, event) {
            if (event) {
                event.preventDefault();
            }
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            document.getElementById(sectionId).classList.remove('hidden');
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            if (sectionId === 'allCandidates') {
                loadAllCandidates();
            } else if (sectionId === 'manageCandidates') {
                loadVendorCandidates();
            } else if (sectionId === 'vendors') {
                loadVendorsTable();
            } else if (sectionId === 'manageVendors') {
                loadManageVendorsTable();
            }
        }

        // Dashboard functions
        async function loadVendorDashboard() {
            try {
                const candidatesRef = window.collection(window.db, 'candidates');
                const q = window.query(candidatesRef, window.where('vendorId', '==', currentUser.id));
                const querySnapshot = await window.getDocs(q);
                
                const candidates = [];
                querySnapshot.forEach((doc) => {
                    candidates.push({ id: doc.id, ...doc.data() });
                });
                
                const selectedCount = candidates.filter(c => c.status === 'Selected' || c.status === 'Joined').length;
                const pendingCount = candidates.filter(c => c.status === 'Interview Pending').length;
                
                document.getElementById('vendorTotalCandidates').textContent = candidates.length;
                document.getElementById('vendorSelectedCandidates').textContent = selectedCount;
                document.getElementById('vendorPendingCandidates').textContent = pendingCount;
            } catch (error) {
                console.error('Error loading vendor dashboard:', error);
            }
        }

        async function loadAdminDashboard() {
            try {
                const candidatesRef = window.collection(window.db, 'candidates');
                const candidatesSnapshot = await window.getDocs(candidatesRef);
                
                const candidates = [];
                candidatesSnapshot.forEach((doc) => {
                    candidates.push({ id: doc.id, ...doc.data() });
                });
                
                const selectedCount = candidates.filter(c => c.status === 'Selected' || c.status === 'Joined').length;
                const pendingCount = candidates.filter(c => c.status === 'Interview Pending').length;
                
                const uniqueVendors = new Set(candidates.map(c => c.vendorId));
                
                document.getElementById('adminTotalCandidates').textContent = candidates.length;
                document.getElementById('adminSelectedCandidates').textContent = selectedCount;
                document.getElementById('adminActiveVendors').textContent = uniqueVendors.size;
                document.getElementById('adminPendingInterviews').textContent = pendingCount;
                
                // Populate vendor filter
                const vendorFilter = document.getElementById('vendorFilter');
                vendorFilter.innerHTML = '<option value="">All Vendors</option>';
                const vendorNames = [...new Set(candidates.map(c => c.vendorName))];
                vendorNames.forEach(vendor => {
                    vendorFilter.innerHTML += `<option value="${sanitizeInput(vendor)}">${sanitizeInput(vendor)}</option>`;
                });
            } catch (error) {
                console.error('Error loading admin dashboard:', error);
            }
        }

        // Candidate management functions
        async function loadVendorCandidates() {
            showLoading('vendorCandidatesLoading');
            try {
                const candidatesRef = window.collection(window.db, 'candidates');
                const q = window.query(candidatesRef, window.where('vendorId', '==', currentUser.id));
                const querySnapshot = await window.getDocs(q);
                
                const candidates = [];
                querySnapshot.forEach((doc) => {
                    candidates.push({ id: doc.id, ...doc.data() });
                });
                
                // Sort by createdAt manually
                candidates.sort((a, b) => {
                    const aTime = a.createdAt?.seconds || 0;
                    const bTime = b.createdAt?.seconds || 0;
                    return bTime - aTime;
                });
                
                const tableBody = document.getElementById('vendorCandidatesTable');
                
                if (candidates.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="7" class="text-center">No candidates found</td></tr>';
                    hideLoading('vendorCandidatesLoading');
                    return;
                }
                
                tableBody.innerHTML = candidates.map(candidate => `
                    <tr>
                        <td><strong>${sanitizeInput(candidate.name)}</strong></td>
                        <td><span class="badge badge-role">${sanitizeInput(candidate.role)}</span></td>
                        <td>${sanitizeInput(candidate.number)}</td>
                        <td>₹${candidate.expectedSalary.toLocaleString()}</td>
                        <td>${candidate.offeredSalary ? '₹' + candidate.offeredSalary.toLocaleString() : '<span class="text-muted">Not Set</span>'}</td>
                        <td><span class="badge ${getStatusBadgeClass(candidate.status)}">${sanitizeInput(candidate.status)}</span></td>
                        <td>
                            <button class="btn btn-action btn-sm" onclick="editCandidate('${candidate.id}')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-action btn-sm" onclick="downloadCandidatePDF('${candidate.id}')" title="Download PDF">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn btn-action btn-sm" onclick="deleteCandidate('${candidate.id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading vendor candidates:', error);
                document.getElementById('vendorCandidatesTable').innerHTML = '<tr><td colspan="7" class="text-center text-danger">Error loading candidates: ' + error.message + '</td></tr>';
            }
            hideLoading('vendorCandidatesLoading');
        }

        window.loadAllCandidates = async function() {
            showLoading('allCandidatesLoading');
            try {
                const candidatesRef = window.collection(window.db, 'candidates');
                const querySnapshot = await window.getDocs(candidatesRef);
                
                let candidates = [];
                querySnapshot.forEach((doc) => {
                    candidates.push({ id: doc.id, ...doc.data() });
                });
                
                // Sort by createdAt manually
                candidates.sort((a, b) => {
                    const aTime = a.createdAt?.seconds || 0;
                    const bTime = b.createdAt?.seconds || 0;
                    return bTime - aTime;
                });
                
                const vendorFilter = document.getElementById('vendorFilter').value;
                const roleFilter = document.getElementById('roleFilter').value;
                
                if (vendorFilter) {
                    candidates = candidates.filter(c => c.vendorName === vendorFilter);
                }
                if (roleFilter) {
                    candidates = candidates.filter(c => c.role === roleFilter);
                }
                
                const tableBody = document.getElementById('adminCandidatesTable');
                
                if (candidates.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="8" class="text-center">No candidates found</td></tr>';
                    hideLoading('allCandidatesLoading');
                    return;
                }
                
                tableBody.innerHTML = candidates.map(candidate => `
                    <tr>
                        <td><strong>${sanitizeInput(candidate.name)}</strong></td>
                        <td>${sanitizeInput(candidate.vendorName)}</td>
                        <td><span class="badge badge-role">${sanitizeInput(candidate.role)}</span></td>
                        <td>${sanitizeInput(candidate.number)}</td>
                        <td>₹${candidate.expectedSalary.toLocaleString()}</td>
                        <td>${candidate.offeredSalary ? '₹' + candidate.offeredSalary.toLocaleString() : '<span class="text-muted">Not Set</span>'}</td>
                        <td><span class="badge ${getStatusBadgeClass(candidate.status)}">${sanitizeInput(candidate.status)}</span></td>
                        <td>
                            <button class="btn btn-action btn-sm" onclick="editCandidateAdmin('${candidate.id}')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-action btn-sm" onclick="downloadCandidatePDF('${candidate.id}')" title="Download PDF">
                                <i class="fas fa-download"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading all candidates:', error);
                document.getElementById('adminCandidatesTable').innerHTML = '<tr><td colspan="8" class="text-center text-danger">Error loading candidates</td></tr>';
            }
            hideLoading('allCandidatesLoading');
        }d></tr>';
            }
            hideLoading('allCandidatesLoading');
        }

        // Candidate CRUD operations
        window.editCandidate = async function(candidateId) {
            try {
                const candidatesRef = window.collection(window.db, 'candidates');
                const querySnapshot = await window.getDocs(candidatesRef);
                let candidate = null;
                
                querySnapshot.forEach((doc) => {
                    if (doc.id === candidateId) {
                        candidate = { id: doc.id, ...doc.data() };
                    }
                });
                
                if (!candidate) return;
                
                document.getElementById('editCandidateId').value = candidate.id;
                document.getElementById('editName').value = candidate.name;
                document.getElementById('editNumber').value = candidate.number;
                document.getElementById('editEmail').value = candidate.email;
                document.getElementById('editRole').value = candidate.role;
                document.getElementById('editCurrentSalary').value = candidate.currentSalary;
                document.getElementById('editExpectedSalary').value = candidate.expectedSalary;
                document.getElementById('editOfferedSalary').value = candidate.offeredSalary || '';
                document.getElementById('editInterviewDate').value = candidate.interviewDate || '';
                document.getElementById('editSelectionDate').value = candidate.selectionDate || '';
                document.getElementById('editJoiningDate').value = candidate.joiningDate || '';
                
                new bootstrap.Modal(document.getElementById('editCandidateModal')).show();
            } catch (error) {
                console.error('Error loading candidate:', error);
                alert('Error loading candidate details');
            }
        }

        window.editCandidateAdmin = async function(candidateId) {
            try {
                const candidatesRef = window.collection(window.db, 'candidates');
                const querySnapshot = await window.getDocs(candidatesRef);
                let candidate = null;
                
                querySnapshot.forEach((doc) => {
                    if (doc.id === candidateId) {
                        candidate = { id: doc.id, ...doc.data() };
                    }
                });
                
                if (!candidate) return;
                
                document.getElementById('editCandidateIdAdmin').value = candidate.id;
                document.getElementById('editNameAdmin').value = candidate.name;
                document.getElementById('editNumberAdmin').value = candidate.number;
                document.getElementById('editEmailAdmin').value = candidate.email;
                document.getElementById('editRoleAdmin').value = candidate.role;
                document.getElementById('editCurrentSalaryAdmin').value = candidate.currentSalary;
                document.getElementById('editExpectedSalaryAdmin').value = candidate.expectedSalary;
                document.getElementById('editOfferedSalaryAdmin').value = candidate.offeredSalary || '';
                document.getElementById('editInterviewDateAdmin').value = candidate.interviewDate || '';
                document.getElementById('editSelectionDateAdmin').value = candidate.selectionDate || '';
                document.getElementById('editJoiningDateAdmin').value = candidate.joiningDate || '';
                
                new bootstrap.Modal(document.getElementById('editCandidateModalAdmin')).show();
            } catch (error) {
                console.error('Error loading candidate:', error);
                alert('Error loading candidate details');
            }
        }

        window.updateCandidate = async function() {
            const candidateId = document.getElementById('editCandidateId').value;
            
            const currentSalary = parseInt(document.getElementById('editCurrentSalary').value);
            const expectedSalary = parseInt(document.getElementById('editExpectedSalary').value);
            
            if (!validateSalary(currentSalary, expectedSalary, null)) {
                return;
            }
            
            try {
                const candidateRef = window.doc(window.db, 'candidates', candidateId);
                await window.updateDoc(candidateRef, {
                    name: document.getElementById('editName').value.trim(),
                    number: document.getElementById('editNumber').value.trim(),
                    email: document.getElementById('editEmail').value.trim(),
                    role: document.getElementById('editRole').value,
                    currentSalary: currentSalary,
                    expectedSalary: expectedSalary,
                    interviewDate: document.getElementById('editInterviewDate').value || null,
                    updatedAt: window.Timestamp.now()
                });
                
                bootstrap.Modal.getInstance(document.getElementById('editCandidateModal')).hide();
                await loadVendorCandidates();
                await loadVendorDashboard();
                
                alert('Candidate updated successfully!');
            } catch (error) {
                console.error('Error updating candidate:', error);
                alert('Error updating candidate. Please try again.');
            }
        }

        window.updateCandidateAdmin = async function() {
            const candidateId = document.getElementById('editCandidateIdAdmin').value;
            
            const currentSalary = parseInt(document.getElementById('editCurrentSalaryAdmin').value);
            const expectedSalary = parseInt(document.getElementById('editExpectedSalaryAdmin').value);
            const offeredSalary = document.getElementById('editOfferedSalaryAdmin').value ? parseInt(document.getElementById('editOfferedSalaryAdmin').value) : null;
            
            if (!validateSalary(currentSalary, expectedSalary, offeredSalary)) {
                return;
            }
            
            const selectionDate = document.getElementById('editSelectionDateAdmin').value || null;
            const joiningDate = document.getElementById('editJoiningDateAdmin').value || null;
            
            try {
                const candidateRef = window.doc(window.db, 'candidates', candidateId);
                await window.updateDoc(candidateRef, {
                    name: document.getElementById('editNameAdmin').value.trim(),
                    number: document.getElementById('editNumberAdmin').value.trim(),
                    email: document.getElementById('editEmailAdmin').value.trim(),
                    role: document.getElementById('editRoleAdmin').value,
                    currentSalary: currentSalary,
                    expectedSalary: expectedSalary,
                    offeredSalary: offeredSalary,
                    interviewDate: document.getElementById('editInterviewDateAdmin').value || null,
                    selectionDate: selectionDate,
                    joiningDate: joiningDate,
                    status: getStatus(selectionDate, joiningDate),
                    updatedAt: window.Timestamp.now()
                });
                
                bootstrap.Modal.getInstance(document.getElementById('editCandidateModalAdmin')).hide();
                await loadAllCandidates();
                await loadAdminDashboard();
                
                alert('Candidate updated successfully! Changes will sync to vendor portal.');
            } catch (error) {
                console.error('Error updating candidate:', error);
                alert('Error updating candidate. Please try again.');
            }
        }

        window.deleteCandidate = async function(candidateId) {
            if (confirm('Are you sure you want to delete this candidate?')) {
                try {
                    await window.deleteDoc(window.doc(window.db, 'candidates', candidateId));
                    await loadVendorCandidates();
                    await loadVendorDashboard();
                    alert('Candidate deleted successfully!');
                } catch (error) {
                    console.error('Error deleting candidate:', error);
                    alert('Error deleting candidate. Please try again.');
                }
            }
        }

        // PDF generation
        window.downloadCandidatePDF = async function(candidateId) {
            try {
                const candidatesRef = window.collection(window.db, 'candidates');
                const querySnapshot = await window.getDocs(candidatesRef);
                let candidate = null;
                
                querySnapshot.forEach((doc) => {
                    if (doc.id === candidateId) {
                        candidate = { id: doc.id, ...doc.data() };
                    }
                });
                
                if (!candidate) return;
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(20);
                doc.setTextColor(0, 82, 204);
                doc.text('Trivanta HR Manager', 20, 25);
                
                doc.setFontSize(14);
                doc.setTextColor(23, 43, 77);
                doc.text('Candidate Profile', 20, 35);
                
                const tableData = [
                    ['Field', 'Value'],
                    ['Full Name', candidate.name],
                    ['Phone Number', candidate.number],
                    ['Email', candidate.email],
                    ['Role', candidate.role],
                    ['Current Salary', `₹${candidate.currentSalary.toLocaleString()}`],
                    ['Expected Salary', `₹${candidate.expectedSalary.toLocaleString()}`],
                    ['Offered Salary', candidate.offeredSalary ? `₹${candidate.offeredSalary.toLocaleString()}` : 'Not Set'],
                    ['Total Experience', `${candidate.totalExperience} Years`],
                    ['Relevant Experience', `${candidate.relevantExperience} Years`],
                    ['Interview Date', candidate.interviewDate || 'Not Scheduled'],
                    ['Selection Date', candidate.selectionDate || 'Not Selected'],
                    ['Joining Date', candidate.joiningDate || 'Not Joined'],
                    ['Status', candidate.status],
                    ['Vendor Name', candidate.vendorName]
                ];
                
                doc.autoTable({
                    head: [tableData[0]],
                    body: tableData.slice(1),
                    startY: 45,
                    styles: { fontSize: 10, cellPadding: 5 },
                    headStyles: { fillColor: [0, 82, 204], textColor: 255 },
                    alternateRowStyles: { fillColor: [250, 251, 252] }
                });
                
                const pageHeight = doc.internal.pageSize.height;
                doc.setFontSize(8);
                doc.setTextColor(128, 128, 128);
                doc.text('Generated by Trivanta HR Manager', 20, pageHeight - 10);
                doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 20, pageHeight - 5);
                
                doc.save(`${candidate.name.replace(/[^a-z0-9]/gi, '_')}_Profile.pdf`);
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Error generating PDF. Please try again.');
            }
        }

        // Vendor management functions
        async function loadManageVendorsTable() {
            showLoading('vendorsManageLoading');
            try {
                const vendorsRef = window.collection(window.db, 'vendors');
                const vendorsSnapshot = await window.getDocs(window.query(vendorsRef, window.orderBy('createdAt', 'desc')));
                
                const vendors = [];
                vendorsSnapshot.forEach((doc) => {
                    vendors.push({ id: doc.id, ...doc.data() });
                });
                
                // Get all candidates to count per vendor
                const candidatesRef = window.collection(window.db, 'candidates');
                const candidatesSnapshot = await window.getDocs(candidatesRef);
                const candidateCounts = {};
                
                candidatesSnapshot.forEach((doc) => {
                    const data = doc.data();
                    candidateCounts[data.vendorId] = (candidateCounts[data.vendorId] || 0) + 1;
                });
                
                const tableBody = document.getElementById('manageVendorsTable');
                
                if (vendors.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="4" class="text-center">No vendors found. Add your first vendor above.</td></tr>';
                    hideLoading('vendorsManageLoading');
                    return;
                }
                
                tableBody.innerHTML = vendors.map(vendor => `
                    <tr>
                        <td><strong>${sanitizeInput(vendor.name)}</strong></td>
                        <td>${sanitizeInput(vendor.username)}</td>
                        <td><span class="badge badge-role">${candidateCounts[vendor.id] || 0}</span></td>
                        <td>
                            <button class="btn btn-action btn-sm" onclick="deleteVendor('${vendor.id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading vendors:', error);
                document.getElementById('manageVendorsTable').innerHTML = '<tr><td colspan="4" class="text-center text-danger">Error loading vendors</td></tr>';
            }
            hideLoading('vendorsManageLoading');
        }

        window.deleteVendor = async function(vendorId) {
            if (confirm('Are you sure you want to delete this vendor? This will not delete their candidates.')) {
                try {
                    await window.deleteDoc(window.doc(window.db, 'vendors', vendorId));
                    await loadManageVendorsTable();
                    showAlert('vendorSuccessAlert', 'Vendor deleted successfully!');
                } catch (error) {
                    console.error('Error deleting vendor:', error);
                    alert('Error deleting vendor. Please try again.');
                }
            }
        }

        async function loadVendorsTable() {
            showLoading('vendorsAnalyticsLoading');
            try {
                const vendorsRef = window.collection(window.db, 'vendors');
                const vendorsSnapshot = await window.getDocs(vendorsRef);
                
                const vendors = [];
                vendorsSnapshot.forEach((doc) => {
                    vendors.push({ id: doc.id, ...doc.data() });
                });
                
                // Get all candidates
                const candidatesRef = window.collection(window.db, 'candidates');
                const candidatesSnapshot = await window.getDocs(candidatesRef);
                
                const vendorStats = vendors.map(vendor => {
                    const vendorCandidates = [];
                    candidatesSnapshot.forEach((doc) => {
                        const data = doc.data();
                        if (data.vendorId === vendor.id) {
                            vendorCandidates.push(data);
                        }
                    });
                    
                    const selected = vendorCandidates.filter(c => c.status === 'Selected' || c.status === 'Joined').length;
                    const successRate = vendorCandidates.length > 0 ? ((selected / vendorCandidates.length) * 100).toFixed(1) : '0';
                    
                    let lastActivity = 'Never';
                    if (vendorCandidates.length > 0) {
                        const dates = vendorCandidates
                            .filter(c => c.createdAt)
                            .map(c => c.createdAt.toDate ? c.createdAt.toDate() : new Date(c.createdAt));
                        if (dates.length > 0) {
                            lastActivity = new Date(Math.max(...dates)).toLocaleDateString();
                        }
                    }
                    
                    return {
                        name: vendor.name,
                        total: vendorCandidates.length,
                        selected: selected,
                        successRate: successRate,
                        lastActivity: lastActivity
                    };
                });
                
                const tableBody = document.getElementById('vendorsTable');
                
                if (vendorStats.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="5" class="text-center">No vendor data available</td></tr>';
                    hideLoading('vendorsAnalyticsLoading');
                    return;
                }
                
                tableBody.innerHTML = vendorStats.map(vendor => `
                    <tr>
                        <td><strong>${sanitizeInput(vendor.name)}</strong></td>
                        <td><span class="badge badge-role">${vendor.total}</span></td>
                        <td><span class="badge badge-status-selected">${vendor.selected}</span></td>
                        <td>${vendor.successRate}%</td>
                        <td>${vendor.lastActivity}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading vendor analytics:', error);
                document.getElementById('vendorsTable').innerHTML = '<tr><td colspan="5" class="text-center text-danger">Error loading analytics</td></tr>';
            }
            hideLoading('vendorsAnalyticsLoading');
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Login form submission
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Add candidate form submission
            document.getElementById('candidateForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const currentSalary = parseInt(formData.get('currentSalary'));
                const expectedSalary = parseInt(formData.get('expectedSalary'));
                const offeredSalary = formData.get('offeredSalary') ? parseInt(formData.get('offeredSalary')) : null;
                
                if (!validateSalary(currentSalary, expectedSalary, offeredSalary)) {
                    return;
                }
                
                const selectionDate = formData.get('selectionDate') || null;
                const joiningDate = formData.get('joiningDate') || null;
                
                const candidate = {
                    vendorId: currentUser.id,
                    vendorName: currentUser.name,
                    name: formData.get('name').trim(),
                    number: formData.get('number').trim(),
                    email: formData.get('email').trim(),
                    role: formData.get('role'),
                    currentSalary: currentSalary,
                    expectedSalary: expectedSalary,
                    offeredSalary: offeredSalary,
                    totalExperience: parseFloat(formData.get('totalExperience')),
                    relevantExperience: parseFloat(formData.get('relevantExperience')),
                    interviewDate: formData.get('interviewDate') || null,
                    selectionDate: selectionDate,
                    joiningDate: joiningDate,
                    status: getStatus(selectionDate, joiningDate),
                    createdAt: window.Timestamp.now()
                };
                
                try {
                    await window.addDoc(window.collection(window.db, 'candidates'), candidate);
                    showAlert('candidateSuccessAlert', 'Candidate added successfully!');
                    this.reset();
                    await loadVendorDashboard();
                } catch (error) {
                    console.error('Error adding candidate:', error);
                    alert('Error adding candidate. Please try again.');
                }
            });
            
            // Add vendor form submission
            document.getElementById('addVendorForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const username = formData.get('vendorUsername').trim();
                
                try {
                    // Check if username already exists
                    const vendorsRef = window.collection(window.db, 'vendors');
                    const q = window.query(vendorsRef, window.where('username', '==', username));
                    const querySnapshot = await window.getDocs(q);
                    
                    if (!querySnapshot.empty) {
                        alert('Username already exists. Please choose a different username.');
                        return;
                    }
                    
                    const vendor = {
                        name: formData.get('vendorName').trim(),
                        username: username,
                        password: formData.get('vendorPassword').trim(),
                        createdAt: window.Timestamp.now()
                    };
                    
                    await window.addDoc(window.collection(window.db, 'vendors'), vendor);
                    showAlert('vendorSuccessAlert', 'Vendor added successfully!');
                    this.reset();
                    await loadManageVendorsTable();
                    await loadAdminDashboard();
                } catch (error) {
                    console.error('Error adding vendor:', error);
                    alert('Error adding vendor. Please try again.');
                }
            });
        });
    </script>
</body>
</html>