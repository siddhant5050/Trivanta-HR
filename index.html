<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trivanta HR Manager</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary-blue: #0052CC;
            --secondary-blue: #0065FF;
            --dark-blue: #003D99;
            --light-blue: #E6F0FF;
            --text-primary: #172B4D;
            --text-secondary: #5E6C84;
            --border-color: #DFE1E6;
            --background: #FAFBFC;
            --white: #FFFFFF;
            --success: #00875A;
            --warning: #FF991F;
            --danger: #DE350B;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .navbar {
            background-color: var(--white);
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
            padding: 1rem 0;
        }
        
        .navbar-brand {
            font-weight: 600;
            font-size: 1.25rem;
            color: var(--primary-blue);
            letter-spacing: -0.02em;
        }
        
        .navbar-text {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .btn-outline-primary {
            color: var(--primary-blue);
            border-color: var(--primary-blue);
        }
        
        .btn-outline-primary:hover {
            background-color: var(--primary-blue);
            border-color: var(--primary-blue);
        }
        
        .sidebar {
            background-color: var(--white);
            border-right: 1px solid var(--border-color);
            min-height: calc(100vh - 73px);
            padding: 0;
        }
        
        .sidebar .nav-link {
            color: var(--text-primary);
            padding: 1rem 1.5rem;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 0.9375rem;
        }
        
        .sidebar .nav-link:hover {
            background-color: var(--light-blue);
            color: var(--primary-blue);
        }
        
        .sidebar .nav-link.active {
            background-color: var(--light-blue);
            color: var(--primary-blue);
            border-left-color: var(--primary-blue);
        }
        
        .sidebar .nav-link i {
            width: 20px;
            margin-right: 0.75rem;
        }
        
        .main-content {
            padding: 2rem 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .card {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
            background-color: var(--white);
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            background-color: var(--white);
            border-bottom: 1px solid var(--border-color);
            padding: 1.25rem 1.5rem;
            font-weight: 600;
            font-size: 1.125rem;
            color: var(--text-primary);
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        .stats-card {
            background-color: var(--white);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-blue);
            line-height: 1;
            margin-bottom: 0.5rem;
        }
        
        .stats-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .login-container {
            min-height: 100vh;
            background-color: var(--background);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .login-card {
            background: var(--white);
            border-radius: 8px;
            padding: 2.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            max-width: 420px;
            width: 100%;
            border: 1px solid var(--border-color);
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .login-header h2 {
            color: var(--primary-blue);
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 1.75rem;
        }
        
        .login-header p {
            color: var(--text-secondary);
            font-size: 0.9375rem;
        }
        
        .form-label {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        .form-control, .form-select {
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 0.75rem;
            font-size: 0.9375rem;
            transition: border-color 0.2s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px var(--light-blue);
            outline: none;
        }
        
        .btn-primary {
            background-color: var(--primary-blue);
            border: none;
            border-radius: 4px;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            font-size: 0.9375rem;
            transition: background-color 0.2s ease;
        }
        
        .btn-primary:hover {
            background-color: var(--dark-blue);
        }
        
        .btn-secondary {
            background-color: var(--text-secondary);
            border: none;
            border-radius: 4px;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
        }
        
        .table {
            font-size: 0.9375rem;
        }
        
        .table thead th {
            background-color: var(--background);
            color: var(--text-primary);
            border-bottom: 2px solid var(--border-color);
            font-weight: 600;
            padding: 1rem 0.75rem;
            font-size: 0.8125rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .table tbody td {
            padding: 1rem 0.75rem;
            vertical-align: middle;
            border-bottom: 1px solid var(--border-color);
        }
        
        .table tbody tr:hover {
            background-color: var(--light-blue);
        }
        
        .badge {
            padding: 0.375rem 0.75rem;
            border-radius: 4px;
            font-weight: 500;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .badge-role {
            background-color: var(--light-blue);
            color: var(--primary-blue);
        }
        
        .badge-status-selected {
            background-color: #E3FCEF;
            color: var(--success);
        }
        
        .badge-status-pending {
            background-color: #FFF0B3;
            color: #974F0C;
        }
        
        .badge-status-joined {
            background-color: #E3FCEF;
            color: var(--success);
        }
        
        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.8125rem;
            border-radius: 4px;
            font-weight: 500;
        }
        
        .btn-action {
            background-color: var(--white);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            margin-right: 0.25rem;
        }
        
        .btn-action:hover {
            background-color: var(--background);
            border-color: var(--primary-blue);
            color: var(--primary-blue);
        }
        
        .hidden {
            display: none;
        }
        
        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
        }
        
        .demo-info {
            background-color: var(--light-blue);
            border: 1px solid var(--primary-blue);
            border-radius: 4px;
            padding: 1rem;
            margin-top: 1.5rem;
            font-size: 0.8125rem;
            color: var(--text-primary);
        }
        
        @media (max-width: 768px) {
            .sidebar {
                min-height: auto;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .stats-card {
                padding: 1rem;
            }
            
            .stats-number {
                font-size: 2rem;
            }
            
            .table {
                font-size: 0.8125rem;
            }
            
            .card-header {
                padding: 1rem;
            }
            
            .card-body {
                padding: 1rem;
            }
            
            .login-card {
                padding: 1.5rem;
            }
        }
        
        @media (max-width: 576px) {
            .table-responsive {
                overflow-x: auto;
            }
            
            .btn-sm {
                padding: 0.25rem 0.5rem;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h2>Trivanta HR Manager</h2>
                <p>Sign in to your account</p>
            </div>
            
            <form id="loginForm">
                <div class="mb-3">
                    <label class="form-label">Username</label>
                    <input type="text" id="username" class="form-control" required placeholder="Enter username">
                </div>
                <div class="mb-3">
                    <label class="form-label">Password</label>
                    <input type="password" id="password" class="form-control" required placeholder="Enter password">
                </div>
                <div class="mb-4">
                    <label class="form-label">Portal Type</label>
                    <select id="userType" class="form-select">
                        <option value="vendor">Vendor Portal</option>
                        <option value="admin">Admin Portal</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary w-100">
                    Sign In
                </button>
            </form>
            
            <div class="demo-info">
                <strong>Admin Login:</strong><br>
                Username: Siddhant<br>
                Password: 102005
            </div>
        </div>
    </div>

    <!-- Vendor Portal -->
    <div id="vendorPortal" class="hidden">
        <nav class="navbar">
            <div class="container-fluid">
                <span class="navbar-brand">
                    <i class="fas fa-users-cog"></i> Trivanta HR - Vendor Portal
                </span>
                <div class="navbar-nav ms-auto d-flex flex-row align-items-center">
                    <span class="navbar-text me-3">Welcome, <span id="vendorName"></span></span>
                    <button class="btn btn-outline-primary btn-sm" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </nav>

        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-2 col-md-3 sidebar">
                    <ul class="nav flex-column pt-3">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showSection('vendorDashboard', event)">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('addCandidate', event)">
                                <i class="fas fa-user-plus"></i> Add Candidate
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('manageCandidates', event)">
                                <i class="fas fa-users"></i> Manage Candidates
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="col-lg-10 col-md-9 main-content">
                    <!-- Vendor Dashboard -->
                    <div id="vendorDashboard" class="section">
                        <h1 class="page-title">Dashboard</h1>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="stats-card">
                                    <div class="stats-number" id="vendorTotalCandidates">0</div>
                                    <div class="stats-label">Total Candidates</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stats-card">
                                    <div class="stats-number" id="vendorSelectedCandidates">0</div>
                                    <div class="stats-label">Selected Candidates</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stats-card">
                                    <div class="stats-number" id="vendorPendingCandidates">0</div>
                                    <div class="stats-label">Pending Interviews</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Add Candidate -->
                    <div id="addCandidate" class="section hidden">
                        <h1 class="page-title">Add New Candidate</h1>
                        <div class="card">
                            <div class="card-body">
                                <form id="candidateForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Full Name</label>
                                            <input type="text" name="name" class="form-control" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Phone Number</label>
                                            <input type="tel" name="number" class="form-control" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Email</label>
                                            <input type="email" name="email" class="form-control" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Role</label>
                                            <select name="role" class="form-select" required>
                                                <option value="">Select Role</option>
                                                <option value="Fitter">Fitter</option>
                                                <option value="Helper">Helper</option>
                                                <option value="Site Supervisor">Site Supervisor</option>
                                                <option value="Welder">Welder</option>
                                                <option value="Parking Operator">Parking Operator</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Current Salary (₹)</label>
                                            <input type="number" name="currentSalary" class="form-control" required>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Expected Salary (₹)</label>
                                            <input type="number" name="expectedSalary" class="form-control" required>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Offered Salary (₹)</label>
                                            <input type="number" name="offeredSalary" class="form-control">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Total Experience (Years)</label>
                                            <input type="number" name="totalExperience" class="form-control" step="0.1" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Relevant Experience (Years)</label>
                                            <input type="number" name="relevantExperience" class="form-control" step="0.1" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Resume Attachment</label>
                                            <input type="file" name="resume" id="resumeFile" class="form-control" accept=".pdf,.doc,.docx">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Date of Interview</label>
                                            <input type="date" name="interviewDate" class="form-control">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Date of Selection</label>
                                            <input type="date" name="selectionDate" class="form-control">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Date of Joining</label>
                                            <input type="date" name="joiningDate" class="form-control">
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <button type="reset" class="btn btn-secondary me-2">Reset</button>
                                        <button type="submit" class="btn btn-primary">Add Candidate</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Manage Candidates -->
                    <div id="manageCandidates" class="section hidden">
                        <h1 class="page-title">Manage Candidates</h1>
                        <div class="card">
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Role</th>
                                                <th>Phone</th>
                                                <th>Expected Salary</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="vendorCandidatesTable"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Portal -->
    <div id="adminPortal" class="hidden">
        <nav class="navbar">
            <div class="container-fluid">
                <span class="navbar-brand">
                    <i class="fas fa-users-cog"></i> Trivanta HR - Admin Portal
                </span>
                <div class="navbar-nav ms-auto d-flex flex-row align-items-center">
                    <span class="navbar-text me-3">Welcome, Administrator</span>
                    <button class="btn btn-outline-primary btn-sm" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </nav>

        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-2 col-md-3 sidebar">
                    <ul class="nav flex-column pt-3">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showSection('adminDashboard', event)">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('allCandidates', event)">
                                <i class="fas fa-users"></i> All Candidates
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('vendors', event)">
                                <i class="fas fa-building"></i> Vendors
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="col-lg-10 col-md-9 main-content">
                    <!-- Admin Dashboard -->
                    <div id="adminDashboard" class="section">
                        <h1 class="page-title">Dashboard</h1>
                        <div class="row">
                            <div class="col-lg-3 col-md-6">
                                <div class="stats-card">
                                    <div class="stats-number" id="adminTotalCandidates">0</div>
                                    <div class="stats-label">Total Candidates</div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="stats-card">
                                    <div class="stats-number" id="adminSelectedCandidates">0</div>
                                    <div class="stats-label">Selected</div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="stats-card">
                                    <div class="stats-number" id="adminActiveVendors">0</div>
                                    <div class="stats-label">Active Vendors</div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="stats-card">
                                    <div class="stats-number" id="adminPendingInterviews">0</div>
                                    <div class="stats-label">Pending Interviews</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- All Candidates -->
                    <div id="allCandidates" class="section hidden">
                        <h1 class="page-title">All Candidates</h1>
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span>Candidate List</span>
                                <div>
                                    <select id="vendorFilter" class="form-select form-select-sm d-inline-block w-auto me-2" onchange="loadAllCandidates()">
                                        <option value="">All Vendors</option>
                                    </select>
                                    <select id="roleFilter" class="form-select form-select-sm d-inline-block w-auto" onchange="loadAllCandidates()">
                                        <option value="">All Roles</option>
                                        <option value="Fitter">Fitter</option>
                                        <option value="Helper">Helper</option>
                                        <option value="Site Supervisor">Site Supervisor</option>
                                        <option value="Welder">Welder</option>
                                        <option value="Parking Operator">Parking Operator</option>
                                    </select>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Vendor</th>
                                                <th>Role</th>
                                                <th>Phone</th>
                                                <th>Expected Salary</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="adminCandidatesTable"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Manage Vendors -->
                    <div id="manageVendors" class="section hidden">
                        <h1 class="page-title">Manage Vendors</h1>
                        
                        <div class="card mb-4">
                            <div class="card-header">Add New Vendor</div>
                            <div class="card-body">
                                <form id="addVendorForm">
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Vendor Name</label>
                                            <input type="text" name="vendorName" class="form-control" required>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Username</label>
                                            <input type="text" name="vendorUsername" class="form-control" required>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Password</label>
                                            <input type="password" name="vendorPassword" class="form-control" required>
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <button type="submit" class="btn btn-primary">Add Vendor</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">All Vendors</div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Vendor Name</th>
                                                <th>Username</th>
                                                <th>Total Candidates</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="manageVendorsTable"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Vendors Analytics -->
                    <div id="vendors" class="section hidden">
                        <h1 class="page-title">Vendor Management</h1>
                        <div class="card">
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Vendor Name</th>
                                                <th>Total Candidates</th>
                                                <th>Selected</th>
                                                <th>Success Rate</th>
                                                <th>Last Activity</th>
                                            </tr>
                                        </thead>
                                        <tbody id="vendorsTable"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Candidate Modal -->
    <div class="modal fade" id="editCandidateModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Candidate</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editCandidateForm">
                        <input type="hidden" id="editCandidateId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Full Name</label>
                                <input type="text" id="editName" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" id="editNumber" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" id="editEmail" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Role</label>
                                <select id="editRole" class="form-select" required>
                                    <option value="Fitter">Fitter</option>
                                    <option value="Helper">Helper</option>
                                    <option value="Site Supervisor">Site Supervisor</option>
                                    <option value="Welder">Welder</option>
                                    <option value="Parking Operator">Parking Operator</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Current Salary (₹)</label>
                                <input type="number" id="editCurrentSalary" class="form-control" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Expected Salary (₹)</label>
                                <input type="number" id="editExpectedSalary" class="form-control" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Offered Salary (₹)</label>
                                <input type="number" id="editOfferedSalary" class="form-control">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Date of Selection</label>
                                <input type="date" id="editSelectionDate" class="form-control">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Date of Joining</label>
                                <input type="date" id="editJoiningDate" class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateCandidate()">Update Candidate</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-storage.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAuaOWWzeD8ranEwesCWLnvU7RTVQzTb7w",
            authDomain: "trivanta-hr.firebaseapp.com",
            projectId: "trivanta-hr",
            storageBucket: "trivanta-hr.firebasestorage.app",
            messagingSenderId: "219158390843",
            appId: "1:219158390843:web:fe37020bbba5329340941e",
            measurementId: "G-Y2D14PC66D"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);
        const analytics = getAnalytics(app);

        window.db = db;
        window.storage = storage;
        window.firestoreModules = { collection, addDoc, getDocs, updateDoc, deleteDoc, doc };
        window.storageModules = { ref, uploadBytes, getDownloadURL };
        
        // Initialize the app after Firebase is loaded
        window.initializeApp();
    </script>

    <script>
        let currentUser = null;
        let candidates = [];
        let vendors = [];

        // Load candidates from Firestore
        async function loadCandidatesFromFirebase() {
            try {
                if (!window.firestoreModules) return;
                const { collection, getDocs } = window.firestoreModules;
                const querySnapshot = await getDocs(collection(window.db, 'candidates'));
                candidates = [];
                querySnapshot.forEach((doc) => {
                    candidates.push({ id: doc.id, ...doc.data() });
                });
            } catch (error) {
                console.error('Error loading candidates:', error);
            }
        }

        // Load vendors from Firestore
        async function loadVendorsFromFirebase() {
            try {
                if (!window.firestoreModules) return;
                const { collection, getDocs } = window.firestoreModules;
                const querySnapshot = await getDocs(collection(window.db, 'vendors'));
                vendors = [];
                querySnapshot.forEach((doc) => {
                    vendors.push({ id: doc.id, ...doc.data() });
                });
            } catch (error) {
                console.error('Error loading vendors:', error);
            }
        }

        // Initialize app
        window.initializeApp = function() {
            // Login System
            document.getElementById('loginForm').addEventListener('submit', async function(e) {
                e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const userType = document.getElementById('userType').value;
            
            if (userType === 'admin' && username === 'admin' && password === 'admin123') {
                currentUser = { type: 'admin', name: 'Administrator' };
                await loadCandidatesFromFirebase();
                showPortal('admin');
            } else if (userType === 'vendor') {
                const vendor = vendors.find(v => v.id === username && v.password === password);
                if (vendor) {
                    currentUser = { type: 'vendor', id: vendor.id, name: vendor.name };
                    document.getElementById('vendorName').textContent = vendor.name;
                    await loadCandidatesFromFirebase();
                    showPortal('vendor');
                } else {
                    alert('Invalid vendor credentials');
                }
            } else {
                alert('Invalid credentials');
            }
        });

        function showPortal(type) {
            document.getElementById('loginScreen').classList.add('hidden');
            if (type === 'admin') {
                document.getElementById('adminPortal').classList.remove('hidden');
                loadAdminDashboard();
            } else {
                document.getElementById('vendorPortal').classList.remove('hidden');
                loadVendorDashboard();
            }
        }

        function logout() {
            currentUser = null;
            candidates = [];
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('adminPortal').classList.add('hidden');
            document.getElementById('vendorPortal').classList.add('hidden');
            document.getElementById('loginForm').reset();
        }

        window.showSection = function(sectionId, event) {
            if (event) {
                event.preventDefault();
            }
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            document.getElementById(sectionId).classList.remove('hidden');
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            if (event) {
                event.target.classList.add('active');
            }
            
            if (sectionId === 'allCandidates') {
                loadAllCandidates();
            } else if (sectionId === 'manageCandidates') {
                loadVendorCandidates();
            } else if (sectionId === 'vendors') {
                loadVendorsTable();
            } else if (sectionId === 'manageVendors') {
                loadManageVendorsTable();
            }
        }

        // Candidate Management
        document.getElementById('candidateForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const resumeFile = document.getElementById('resumeFile').files[0];
            
            let resumeURL = null;
            if (resumeFile) {
                try {
                    const { ref, uploadBytes, getDownloadURL } = window.storageModules;
                    const storageRef = ref(window.storage, `resumes/${Date.now()}_${resumeFile.name}`);
                    await uploadBytes(storageRef, resumeFile);
                    resumeURL = await getDownloadURL(storageRef);
                } catch (error) {
                    console.error('Error uploading resume:', error);
                }
            }
            
            const candidate = {
                vendorId: currentUser.id,
                vendorName: currentUser.name,
                name: formData.get('name'),
                number: formData.get('number'),
                email: formData.get('email'),
                role: formData.get('role'),
                currentSalary: parseInt(formData.get('currentSalary')),
                expectedSalary: parseInt(formData.get('expectedSalary')),
                offeredSalary: formData.get('offeredSalary') ? parseInt(formData.get('offeredSalary')) : null,
                totalExperience: parseFloat(formData.get('totalExperience')),
                relevantExperience: parseFloat(formData.get('relevantExperience')),
                resumeURL: resumeURL,
                interviewDate: formData.get('interviewDate') || null,
                selectionDate: formData.get('selectionDate') || null,
                joiningDate: formData.get('joiningDate') || null,
                status: getStatus(formData.get('selectionDate'), formData.get('joiningDate')),
                createdAt: new Date().toISOString()
            };
            
            try {
                const { collection, addDoc } = window.firestoreModules;
                await addDoc(collection(window.db, 'candidates'), candidate);
                await loadCandidatesFromFirebase();
                alert('Candidate added successfully!');
                this.reset();
                loadVendorDashboard();
            } catch (error) {
                console.error('Error adding candidate:', error);
                alert('Error adding candidate. Please try again.');
            }
        });

        function getStatus(selectionDate, joiningDate) {
            if (joiningDate) return 'Joined';
            if (selectionDate) return 'Selected';
            return 'Interview Pending';
        }

        function getStatusBadgeClass(status) {
            const statusMap = {
                'Joined': 'badge-status-joined',
                'Selected': 'badge-status-selected',
                'Interview Pending': 'badge-status-pending'
            };
            return statusMap[status] || 'badge-status-pending';
        }

        function loadVendorDashboard() {
            const vendorCandidates = candidates.filter(c => c.vendorId === currentUser.id);
            const selectedCount = vendorCandidates.filter(c => c.status === 'Selected' || c.status === 'Joined').length;
            const pendingCount = vendorCandidates.filter(c => c.status === 'Interview Pending').length;
            
            document.getElementById('vendorTotalCandidates').textContent = vendorCandidates.length;
            document.getElementById('vendorSelectedCandidates').textContent = selectedCount;
            document.getElementById('vendorPendingCandidates').textContent = pendingCount;
        }

        function loadAdminDashboard() {
            const selectedCount = candidates.filter(c => c.status === 'Selected' || c.status === 'Joined').length;
            const pendingCount = candidates.filter(c => c.status === 'Interview Pending').length;
            const activeVendorsCount = new Set(candidates.map(c => c.vendorId)).size;
            
            document.getElementById('adminTotalCandidates').textContent = candidates.length;
            document.getElementById('adminSelectedCandidates').textContent = selectedCount;
            document.getElementById('adminActiveVendors').textContent = activeVendorsCount;
            document.getElementById('adminPendingInterviews').textContent = pendingCount;
            
            const vendorFilter = document.getElementById('vendorFilter');
            vendorFilter.innerHTML = '<option value="">All Vendors</option>';
            const uniqueVendors = [...new Set(candidates.map(c => c.vendorName))];
            uniqueVendors.forEach(vendor => {
                vendorFilter.innerHTML += `<option value="${vendor}">${vendor}</option>`;
            });
        }

        function loadVendorCandidates() {
            const vendorCandidates = candidates.filter(c => c.vendorId === currentUser.id);
            const tableBody = document.getElementById('vendorCandidatesTable');
            
            if (vendorCandidates.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center">No candidates found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = vendorCandidates.map(candidate => `
                <tr>
                    <td><strong>${candidate.name}</strong></td>
                    <td><span class="badge badge-role">${candidate.role}</span></td>
                    <td>${candidate.number}</td>
                    <td>₹${candidate.expectedSalary.toLocaleString()}</td>
                    <td><span class="badge ${getStatusBadgeClass(candidate.status)}">${candidate.status}</span></td>
                    <td>
                        <button class="btn btn-action btn-sm" onclick="editCandidate('${candidate.id}')" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-action btn-sm" onclick="downloadCandidatePDF('${candidate.id}')" title="Download PDF">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="btn btn-action btn-sm" onclick="deleteCandidate('${candidate.id}')" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function loadAllCandidates() {
            const tableBody = document.getElementById('adminCandidatesTable');
            let filteredCandidates = candidates;
            
            const vendorFilter = document.getElementById('vendorFilter').value;
            const roleFilter = document.getElementById('roleFilter').value;
            
            if (vendorFilter) {
                filteredCandidates = filteredCandidates.filter(c => c.vendorName === vendorFilter);
            }
            if (roleFilter) {
                filteredCandidates = filteredCandidates.filter(c => c.role === roleFilter);
            }
            
            if (filteredCandidates.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center">No candidates found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = filteredCandidates.map(candidate => `
                <tr>
                    <td><strong>${candidate.name}</strong></td>
                    <td>${candidate.vendorName}</td>
                    <td><span class="badge badge-role">${candidate.role}</span></td>
                    <td>${candidate.number}</td>
                    <td>₹${candidate.expectedSalary.toLocaleString()}</td>
                    <td><span class="badge ${getStatusBadgeClass(candidate.status)}">${candidate.status}</span></td>
                    <td>
                        <button class="btn btn-action btn-sm" onclick="downloadCandidatePDF('${candidate.id}')" title="Download PDF">
                            <i class="fas fa-download"></i>
                        </button>
                        ${candidate.resumeURL ? `<a href="${candidate.resumeURL}" target="_blank" class="btn btn-action btn-sm" title="View Resume"><i class="fas fa-file"></i></a>` : ''}
                    </td>
                </tr>
            `).join('');
        }

        window.editCandidate = function(candidateId) {
            const candidate = candidates.find(c => c.id === candidateId);
            if (!candidate) return;
            
            document.getElementById('editCandidateId').value = candidate.id;
            document.getElementById('editName').value = candidate.name;
            document.getElementById('editNumber').value = candidate.number;
            document.getElementById('editEmail').value = candidate.email;
            document.getElementById('editRole').value = candidate.role;
            document.getElementById('editCurrentSalary').value = candidate.currentSalary;
            document.getElementById('editExpectedSalary').value = candidate.expectedSalary;
            document.getElementById('editOfferedSalary').value = candidate.offeredSalary || '';
            document.getElementById('editSelectionDate').value = candidate.selectionDate || '';
            document.getElementById('editJoiningDate').value = candidate.joiningDate || '';
            
            new bootstrap.Modal(document.getElementById('editCandidateModal')).show();
        }

        window.updateCandidate = async function() {
            const candidateId = document.getElementById('editCandidateId').value;
            const candidateData = candidates.find(c => c.id === candidateId);
            
            if (!candidateData) return;
            
            const updatedData = {
                ...candidateData,
                name: document.getElementById('editName').value,
                number: document.getElementById('editNumber').value,
                email: document.getElementById('editEmail').value,
                role: document.getElementById('editRole').value,
                currentSalary: parseInt(document.getElementById('editCurrentSalary').value),
                expectedSalary: parseInt(document.getElementById('editExpectedSalary').value),
                offeredSalary: document.getElementById('editOfferedSalary').value ? parseInt(document.getElementById('editOfferedSalary').value) : null,
                selectionDate: document.getElementById('editSelectionDate').value || null,
                joiningDate: document.getElementById('editJoiningDate').value || null,
                status: getStatus(document.getElementById('editSelectionDate').value, document.getElementById('editJoiningDate').value)
            };
            
            try {
                const { doc, updateDoc } = window.firestoreModules;
                await updateDoc(doc(window.db, 'candidates', candidateId), updatedData);
                await loadCandidatesFromFirebase();
                
                bootstrap.Modal.getInstance(document.getElementById('editCandidateModal')).hide();
                loadVendorCandidates();
                loadVendorDashboard();
                
                alert('Candidate updated successfully!');
            } catch (error) {
                console.error('Error updating candidate:', error);
                alert('Error updating candidate. Please try again.');
            }
        }

        window.deleteCandidate = async function(candidateId) {
            if (confirm('Are you sure you want to delete this candidate?')) {
                try {
                    const { doc, deleteDoc } = window.firestoreModules;
                    await deleteDoc(doc(window.db, 'candidates', candidateId));
                    await loadCandidatesFromFirebase();
                    loadVendorCandidates();
                    loadVendorDashboard();
                    alert('Candidate deleted successfully!');
                } catch (error) {
                    console.error('Error deleting candidate:', error);
                    alert('Error deleting candidate. Please try again.');
                }
            }
        }

        window.downloadCandidatePDF = function(candidateId) {
            const candidate = candidates.find(c => c.id === candidateId);
            if (!candidate) return;
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.setTextColor(0, 82, 204);
            doc.text('Trivanta HR Manager', 20, 25);
            
            doc.setFontSize(14);
            doc.setTextColor(23, 43, 77);
            doc.text('Candidate Profile', 20, 35);
            
            const tableData = [
                ['Field', 'Value'],
                ['Full Name', candidate.name],
                ['Phone Number', candidate.number],
                ['Email', candidate.email],
                ['Role', candidate.role],
                ['Current Salary', `₹${candidate.currentSalary.toLocaleString()}`],
                ['Expected Salary', `₹${candidate.expectedSalary.toLocaleString()}`],
                ['Offered Salary', candidate.offeredSalary ? `₹${candidate.offeredSalary.toLocaleString()}` : 'Not Set'],
                ['Total Experience', `${candidate.totalExperience} Years`],
                ['Relevant Experience', `${candidate.relevantExperience} Years`],
                ['Interview Date', candidate.interviewDate || 'Not Scheduled'],
                ['Selection Date', candidate.selectionDate || 'Not Selected'],
                ['Joining Date', candidate.joiningDate || 'Not Joined'],
                ['Status', candidate.status],
                ['Vendor Name', candidate.vendorName]
            ];
            
            doc.autoTable({
                head: [tableData[0]],
                body: tableData.slice(1),
                startY: 45,
                styles: { fontSize: 10, cellPadding: 5 },
                headStyles: { fillColor: [0, 82, 204], textColor: 255 },
                alternateRowStyles: { fillColor: [250, 251, 252] }
            });
            
            const pageHeight = doc.internal.pageSize.height;
            doc.setFontSize(8);
            doc.setTextColor(128, 128, 128);
            doc.text('Generated by Trivanta HR Manager', 20, pageHeight - 10);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 20, pageHeight - 5);
            
            doc.save(`${candidate.name}_Profile.pdf`);
        }

        function loadManageVendorsTable() {
            const tableBody = document.getElementById('manageVendorsTable');
            
            if (vendors.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" class="text-center">No vendors found. Add your first vendor above.</td></tr>';
                return;
            }
            
            tableBody.innerHTML = vendors.map(vendor => {
                const vendorCandidates = candidates.filter(c => c.vendorId === vendor.id);
                return `
                    <tr>
                        <td><strong>${vendor.name}</strong></td>
                        <td>${vendor.username}</td>
                        <td><span class="badge badge-role">${vendorCandidates.length}</span></td>
                        <td>
                            <button class="btn btn-action btn-sm" onclick="deleteVendor('${vendor.id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        window.deleteVendor = async function(vendorId) {
            if (confirm('Are you sure you want to delete this vendor? This will not delete their candidates.')) {
                try {
                    const { doc, deleteDoc } = window.firestoreModules;
                    await deleteDoc(doc(window.db, 'vendors', vendorId));
                    await loadVendorsFromFirebase();
                    loadManageVendorsTable();
                    alert('Vendor deleted successfully!');
                } catch (error) {
                    console.error('Error deleting vendor:', error);
                    alert('Error deleting vendor. Please try again.');
                }
            }
        }

        function loadVendorsTable() {
            const tableBody = document.getElementById('vendorsTable');
            
            const vendorStats = vendors.map(vendor => {
                const vendorCandidates = candidates.filter(c => c.vendorId === vendor.id);
                const selected = vendorCandidates.filter(c => c.status === 'Selected' || c.status === 'Joined').length;
                const successRate = vendorCandidates.length > 0 ? ((selected / vendorCandidates.length) * 100).toFixed(1) : '0';
                const lastActivity = vendorCandidates.length > 0 ? 
                    new Date(Math.max(...vendorCandidates.map(c => new Date(c.createdAt)))).toLocaleDateString() : 
                    'Never';
                
                return {
                    ...vendor,
                    total: vendorCandidates.length,
                    selected: selected,
                    successRate: successRate,
                    lastActivity: lastActivity
                };
            });
            
            tableBody.innerHTML = vendorStats.map(vendor => `
                <tr>
                    <td><strong>${vendor.name}</strong></td>
                    <td><span class="badge badge-role">${vendor.total}</span></td>
                    <td><span class="badge badge-status-selected">${vendor.selected}</span></td>
                    <td>${vendor.successRate}%</td>
                    <td>${vendor.lastActivity}</td>
                </tr>
            `).join('');
        }

        window.loadAllCandidates = loadAllCandidates;
    </script>
</body>
</html>
